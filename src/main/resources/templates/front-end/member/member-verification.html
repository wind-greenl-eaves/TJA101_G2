<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡é©—è­‰ - æ—©é¤åº—æœƒå“¡ç³»çµ±</title>
    
    <!-- å¼•å…¥ Font Awesome åœ–ç¤ºåº« -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- å¼•å…¥ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #FDFBF6;
            --container-bg: #FFFFFF;
            --primary-color: #A67B5B;
            --primary-hover: #8C684A;
            --text-color: #5D534A;
            --border-color: #DED0B6;
            --error-color: #D9534F;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --placeholder-color: #B0A495;
            --input-focus-ring: rgba(166, 123, 91, 0.2);
        }
        
        body {
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #FDFBF6 0%, #F5EFE6 100%);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .verification-container {
            background: var(--container-bg);
            padding: 40px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            margin: 20px;
        }
        
        .logo {
            text-align: center;
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .verification-title {
            color: var(--primary-color);
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .verification-subtitle {
            color: var(--text-color);
            margin-bottom: 30px;
            font-size: 14px;
            text-align: center;
            line-height: 1.5;
        }
        
        .info-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .info-box .icon {
            color: var(--primary-color);
            margin-right: 8px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
            font-size: 14px;
        }
        
        .required {
            color: var(--error-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
            background-color: var(--container-bg);
            color: var(--text-color);
        }
        
        .form-control::placeholder {
            color: var(--placeholder-color);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--input-focus-ring);
        }
        
        .form-control.is-invalid {
            border-color: var(--error-color);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .verification-code-input {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 8px;
            font-family: 'Courier New', monospace;
        }
        
        .verify-btn {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .verify-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(166, 123, 91, 0.3);
        }
        
        .verify-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .resend-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        
        .resend-text {
            color: var(--text-color);
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .resend-btn {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .resend-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .resend-btn:disabled {
            background-color: #f8f9fa;
            color: #ccc;
            border-color: #ccc;
            cursor: not-allowed;
        }
        
        .countdown {
            color: var(--warning-color);
            font-weight: bold;
        }
        
        .login-link {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            color: var(--text-color);
            font-size: 14px;
            text-align: center;
        }
        
        .login-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .login-link a:hover {
            text-decoration: underline;
            color: var(--primary-hover);
        }
        
        .alert {
            padding: 12px 16px;
            margin: 20px 0;
            border-radius: 6px;
            font-size: 14px;
            border: 1px solid;
        }
        
        .alert-error {
            background-color: #fef2f2;
            border-color: var(--error-color);
            color: var(--error-color);
        }
        
        .alert-success {
            background-color: #f0f9ff;
            border-color: var(--success-color);
            color: var(--success-color);
        }
        
        .invalid-feedback {
            display: block;
            color: var(--error-color);
            font-size: 12px;
            margin-top: 5px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .message {
            margin: 15px 0;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="verification-container">
        <div class="logo">ğŸ³</div>
        <h1 class="verification-title">æœƒå“¡é©—è­‰</h1>
        <p class="verification-subtitle">è«‹è¼¸å…¥æ‚¨æ”¶åˆ°çš„6ä½æ•¸é©—è­‰ç¢¼ä¾†å•Ÿç”¨å¸³è™Ÿ</p>
        
        <!-- ä¿¡æ¯æç¤ºæ¡† -->
        <div class="info-box">
            <i class="fas fa-info-circle icon"></i>
            é©—è­‰ç¢¼å·²ç™¼é€è‡³ <strong>young19960127@gmail.com</strong><br>
            è«‹æŸ¥æ”¶éƒµä»¶ä¸¦è¼¸å…¥6ä½æ•¸é©—è­‰ç¢¼ï¼Œé©—è­‰ç¢¼æœ‰æ•ˆæœŸç‚º 15 åˆ†é˜ã€‚
        </div>
        
        <!-- é©—è­‰è¡¨å–® -->
        <form th:action="@{/member/verify}" method="post" th:object="${memberVerificationRequest}" id="verificationForm">
            
            <!-- é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ -->
            <div th:if="${#fields.hasAnyErrors()}" class="alert alert-error">
                <ul style="margin: 0; padding-left: 20px;">
                    <li th:each="error : ${#fields.allErrors()}" th:text="${error}"></li>
                </ul>
            </div>
            
            <div class="form-group">
                <label for="email">é›»å­éƒµä»¶ <span class="required">*</span></label>
                <input type="email" 
                       id="email" 
                       th:field="*{email}"
                       class="form-control" 
                       placeholder="è«‹è¼¸å…¥è¨»å†Šæ™‚ä½¿ç”¨çš„é›»å­éƒµä»¶"
                       required>
                <div th:if="${#fields.hasErrors('email')}" class="invalid-feedback" th:errors="*{email}"></div>
            </div>
            
            <div class="form-group">
                <label for="verificationCode">é©—è­‰ç¢¼ <span class="required">*</span></label>
                <input type="text" 
                       id="verificationCode" 
                       th:field="*{verificationCode}"
                       class="form-control verification-code-input" 
                       placeholder="è«‹è¼¸å…¥6ä½æ•¸é©—è­‰ç¢¼"
                       maxlength="6"
                       pattern="[0-9]{6}"
                       required>
                <div th:if="${#fields.hasErrors('verificationCode')}" class="invalid-feedback" th:errors="*{verificationCode}"></div>
            </div>
            
            <button type="submit" class="verify-btn" id="verifyButton">
                <i class="fas fa-check-circle"></i> é©—è­‰ä¸¦å•Ÿç”¨å¸³è™Ÿ
            </button>
        </form>
        
        <!-- é‡æ–°ç™¼é€é©—è­‰ç¢¼å€åŸŸ -->
        <div class="resend-section">
            <div class="resend-text">æ²’æœ‰æ”¶åˆ°é©—è­‰ç¢¼ï¼Ÿ</div>
            <button type="button" class="resend-btn" id="resendButton">
                <i class="fas fa-envelope"></i> é‡æ–°ç™¼é€é©—è­‰ç¢¼
            </button>
            <div id="resendMessage" class="message" style="display: none;"></div>
            <div id="countdown" style="display: none; margin-top: 10px; font-size: 14px;">
                è«‹ç­‰å¾… <span class="countdown" id="countdownTime">60</span> ç§’å¾Œå†é‡æ–°ç™¼é€
            </div>
        </div>
        
        <div class="login-link">
            å·²ç¶“é©—è­‰å®Œæˆï¼Ÿ
            <a th:href="@{/api/v1/auth/member-login}">ç«‹å³ç™»å…¥</a>
        </div>
    </div>
    
    <script>
        let countdownTimer = null;
        let resendCooldown = 60; // 60ç§’å†·å»æ™‚é–“
        
        // è¡¨å–®é©—è­‰
        document.getElementById('verificationForm').addEventListener('submit', function(e) {
            const email = document.getElementById('email').value.trim();
            const code = document.getElementById('verificationCode').value.trim();
            
            // åŸºæœ¬é©—è­‰
            if (!email || !code) {
                e.preventDefault();
                return false;
            }
            
            // é©—è­‰ç¢¼æ ¼å¼æª¢æŸ¥
            if (!/^\d{6}$/.test(code)) {
                e.preventDefault();
                alert('è«‹è¼¸å…¥6ä½æ•¸å­—é©—è­‰ç¢¼');
                return false;
            }
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            const button = document.getElementById('verifyButton');
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> é©—è­‰ä¸­...';
        });
        
        // é©—è­‰ç¢¼è¼¸å…¥æ¡†è‡ªå‹•æ ¼å¼åŒ–
        document.getElementById('verificationCode').addEventListener('input', function(e) {
            // åªå…è¨±æ•¸å­—
            e.target.value = e.target.value.replace(/\D/g, '');
            
            // é™åˆ¶é•·åº¦ç‚º6ä½
            if (e.target.value.length > 6) {
                e.target.value = e.target.value.slice(0, 6);
            }
        });
        
        // é‡æ–°ç™¼é€é©—è­‰ç¢¼
        document.getElementById('resendButton').addEventListener('click', function() {
            const email = document.getElementById('email').value.trim();
            const messageDiv = document.getElementById('resendMessage');
            const button = this;
            
            if (!email) {
                showMessage('è«‹å…ˆè¼¸å…¥é›»å­éƒµä»¶åœ°å€', 'error');
                return;
            }
            
            // é©—è­‰emailæ ¼å¼
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶æ ¼å¼', 'error');
                return;
            }
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> ç™¼é€ä¸­...';
            
            // ç™¼é€AJAXè«‹æ±‚
            fetch('/member/resend-verification', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'email=' + encodeURIComponent(email)
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('ç™¼é€å¤±æ•—');
                }
            })
            .then(data => {
                showMessage(data, 'success');
                startCountdown();
            })
            .catch(error => {
                console.error('Error:', error);
                showMessage('é‡æ–°ç™¼é€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-envelope"></i> é‡æ–°ç™¼é€é©—è­‰ç¢¼';
            });
        });
        
        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(text, type) {
            const messageDiv = document.getElementById('resendMessage');
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';
            
            // 3ç§’å¾Œè‡ªå‹•éš±è—
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
        
        // å€’æ•¸è¨ˆæ™‚
        function startCountdown() {
            const button = document.getElementById('resendButton');
            const countdownDiv = document.getElementById('countdown');
            const countdownTime = document.getElementById('countdownTime');
            
            let timeLeft = resendCooldown;
            button.style.display = 'none';
            countdownDiv.style.display = 'block';
            
            countdownTimer = setInterval(() => {
                timeLeft--;
                countdownTime.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(countdownTimer);
                    countdownDiv.style.display = 'none';
                    button.style.display = 'inline-block';
                    button.disabled = false;
                    button.innerHTML = '<i class="fas fa-envelope"></i> é‡æ–°ç™¼é€é©—è­‰ç¢¼';
                }
            }, 1000);
        }
        
        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥æ˜¯å¦æœ‰é è¨­email
        document.addEventListener('DOMContentLoaded', function() {
            const emailInput = document.getElementById('email');
            if (emailInput.value.trim()) {
                // å¦‚æœæœ‰é è¨­emailï¼Œè‡ªå‹•èšç„¦åˆ°é©—è­‰ç¢¼è¼¸å…¥æ¡†
                document.getElementById('verificationCode').focus();
            } else {
                // å¦‚æœæ²’æœ‰ï¼Œèšç„¦åˆ°emailè¼¸å…¥æ¡†
                emailInput.focus();
            }
        });
        
        // Enteréµå¿«é€Ÿæ“ä½œ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'email' && activeElement.value.trim()) {
                    // åœ¨emailè¼¸å…¥æ¡†æŒ‰Enterï¼Œè·³åˆ°é©—è­‰ç¢¼è¼¸å…¥æ¡†
                    document.getElementById('verificationCode').focus();
                    e.preventDefault();
                }
            }
        });
    </script>
</body>
</html>