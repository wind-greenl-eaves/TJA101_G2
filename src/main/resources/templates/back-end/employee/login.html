<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©é¤åº—å¾Œå° - å“¡å·¥ç™»å…¥</title>
    
    <!-- å¼•å…¥ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- å¼•å…¥ Font Awesome åœ–ç¤ºåº« -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #FDFBF6;
            --container-bg: #F5EFE6;
            --primary-color: #A67B5B;
            --primary-hover: #8C684A;
            --text-color: #5D534A;
            --border-color: #DED0B6;
            --error-color: #D9534F;
            --success-color: #5cb85c;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: auto;
        }
        
        .page-wrapper {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            padding: 20px;
            width: 100%;
            max-width: 1200px;
            justify-content: center; /* ã€æ–°å¢ã€‘æ°´å¹³ç½®ä¸­ */
            margin: 0 auto; /* ã€æ–°å¢ã€‘ç¢ºä¿æ•´å€‹å®¹å™¨åœ¨é é¢ä¸­ç½®ä¸­ */
        }
        
        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 40px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            text-align: center;
            flex-shrink: 0;
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 20px;
        }
        
        .login-container h2 {
            margin-bottom: 30px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            box-sizing: border-box;
            font-size: 16px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(166, 123, 91, 0.2);
        }
        
        /* å¯†ç¢¼è¼¸å…¥æ¡†çš„å¤–å±¤å®¹å™¨æ¨£å¼ */
        .password-wrapper {
            position: relative;
        }
        
        /* å¯†ç¢¼åˆ‡æ›åœ–ç¤ºçš„æ¨£å¼ */
        .password-toggle-icon {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }
        
        .password-toggle-icon:hover {
            color: var(--primary-color);
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }
        
        .btn-primary { 
            background-color: var(--primary-color); 
        }
        
        .btn-primary:hover { 
            background-color: var(--primary-hover); 
        }
        
        .error-msg {
            color: var(--error-color);
            background-color: #FFF2F2;
            border: 1px solid var(--error-color);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .success-msg {
            color: var(--success-color);
            background-color: #F0F8F0;
            border: 1px solid var(--success-color);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .forgot-password-link {
            display: block;
            margin-top: 20px;
            font-size: 14px;
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .forgot-password-link:hover {
            text-decoration: underline;
        }

        /* ç®¡ç†å“¡å°å¹«æ‰‹å€å¡Šæ¨£å¼ */
        .admin-helper {
            width: 350px;
            padding: 30px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border: 1px solid var(--container-bg);
            flex-shrink: 0;
        }
        
        .admin-helper h3 {
            margin-top: 0;
            text-align: center;
            color: var(--primary-color);
            border-bottom: 2px solid var(--container-bg);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .admin-helper .info-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
            max-height: 400px; 
            overflow-y: auto;
        }
        
        .admin-helper .info-list li {
            padding: 10px 5px;
            border-bottom: 1px dashed var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .admin-helper .info-list li:hover {
            background-color: var(--container-bg);
        }
        
        .admin-helper .info-list li:last-child {
            border-bottom: none;
        }
        
        .info-list .employee-main-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-name {
            font-weight: 500;
        }
        
        .info-account {
            color: #777;
            font-family: monospace;
        }
        
        .employee-details {
            background-color: #fdfdfd;
            border: 1px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 0 0 6px 6px;
            padding: 10px;
            margin-top: 5px;
            font-size: 14px;
            display: none;
        }
        
        .employee-details p {
            margin: 5px 0;
        }
        
        .employee-details .label {
            font-weight: 500;
            color: var(--primary-color);
            display: inline-block;
            width: 80px;
        }

        /* å·²åœæ¬Šå“¡å·¥æ¨£å¼ */
        .inactive-employees {
            border-top: 2px solid #D9534F;
            margin-top: 30px;
            padding-top: 15px;
        }
        
        .inactive-employees h3 {
            color: #D9534F;
        }
        
        .inactive-employees .info-list {
            max-height: 300px;
        }
        
        .inactive-item {
            opacity: 0.7;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 850px) {
            .page-wrapper {
                flex-direction: column;
                align-items: center;
                gap: 20px;
                padding: 15px;
            }
            
            .login-container {
                width: 90%;
                max-width: 400px;
                padding: 30px 20px;
                box-sizing: border-box;
            }
            
            .admin-helper {
                width: 90%;
                max-width: 400px;
                box-sizing: border-box;
                margin-top: 0;
                padding: 20px;
            }

            .form-group label, .form-group input, .btn {
                font-size: 15px;
            }
            
            .form-group input {
                padding: 10px;
            }
            
            .btn {
                padding: 10px;
            }
            
            .login-container h2 {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .login-logo {
                width: 60px;
                height: 60px;
            }
            
            .error-msg, .success-msg {
                padding: 8px;
                font-size: 14px;
            }
            
            .forgot-password-link {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .login-container, .admin-helper {
                width: 95%;
            }
            
            body {
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- ç™»å…¥è¡¨å–®å€å¡Š -->
        <div class="login-container">
            <img th:src="@{/images/123.png}" alt="ç³»çµ±Logo" class="login-logo">
            <h2>å“¡å·¥å¾Œå°ç™»å…¥</h2>

            <!-- é¡¯ç¤ºæˆåŠŸè¨Šæ¯ -->
            <div th:if="${successMessage}" class="success-msg">
                <p th:text="${successMessage}"></p>
            </div>

            <!-- é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ -->
            <div th:if="${errorMessage}" class="error-msg">
                <p th:text="${errorMessage}"></p>
                
                <!-- ã€æ–°å¢ã€‘ç™»å…¥å¤±æ•—æ¬¡æ•¸è­¦å‘Šé¡¯ç¤º -->
                <div th:if="${errorMessage != null and (#strings.contains(errorMessage, 'é‚„æœ‰') or #strings.contains(errorMessage, 'æ¬¡ç™»å…¥æ©Ÿæœƒ'))}" 
                     class="mt-3 p-3 bg-yellow-50 border border-yellow-400 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                        <span class="text-yellow-800 font-semibold">å®‰å…¨è­¦å‘Š</span>
                    </div>
                    <div class="mt-2 text-yellow-700 text-sm">
                        <p>âš ï¸ æ‚¨çš„å¸³è™Ÿç™»å…¥å¤±æ•—æ¬¡æ•¸éå¤š</p>
                        <p>ğŸ”’ é”åˆ° 8 æ¬¡å¤±æ•—å°‡è‡ªå‹•åœç”¨å¸³è™Ÿ</p>
                        <p>ğŸ’¡ è«‹ç¢ºèªå¸³è™Ÿå¯†ç¢¼æ˜¯å¦æ­£ç¢º</p>
                    </div>
                </div>
                
                <!-- ã€æ–°å¢ã€‘å¸³è™Ÿè¢«é–å®šçš„æç¤º -->
                <div th:if="${errorMessage != null and #strings.contains(errorMessage, 'å·²è¢«åœç”¨')}" 
                     class="mt-3 p-3 bg-red-50 border border-red-400 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-lock text-red-600 mr-2"></i>
                        <span class="text-red-800 font-semibold">å¸³è™Ÿå·²é–å®š</span>
                    </div>
                    <div class="mt-2 text-red-700 text-sm">
                        <p>ğŸš« æ‚¨çš„å¸³è™Ÿå› ç™»å…¥å¤±æ•—æ¬¡æ•¸éå¤šå·²è¢«åœç”¨</p>
                        <p>ğŸ“ è«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡è§£é–å¸³è™Ÿ</p>
                        <p>ğŸ”§ ç®¡ç†å“¡å¯é€éå¾Œå°é‡ç½®æ‚¨çš„ç™»å…¥å¤±æ•—æ¬¡æ•¸</p>
                    </div>
                </div>
            </div>

            <!-- é¡¯ç¤ºè¡¨å–®é©—è­‰éŒ¯èª¤ -->
            <div th:if="${#fields.hasErrors('loginRequest')}" class="error-msg">
                <ul th:each="error : ${#fields.errors('loginRequest')}">
                    <li th:text="${error}"></li>
                </ul>
            </div>

            <!-- ç™»å…¥è¡¨å–® -->
            <form th:action="@{/employee/login}" th:object="${loginRequest}" method="post">
                <!-- éš±è—æ¬„ä½ï¼šä¿å­˜è¿”å›URL -->
                <input type="hidden" name="returnUrl" th:value="${returnUrl}" th:if="${returnUrl != null}">
                
                <div class="form-group">
                    <label for="account">å“¡å·¥å¸³è™Ÿ:</label>
                    <input type="text" 
                           id="account" 
                           th:field="*{account}" 
                           autocomplete="username"
                           th:class="${#fields.hasErrors('account')} ? 'error' : ''">
                    <div th:if="${#fields.hasErrors('account')}" class="error-msg">
                        <span th:errors="*{account}"></span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">ç™»å…¥å¯†ç¢¼:</label>
                    <div class="password-wrapper">
                        <input type="password" 
                               id="password" 
                               th:field="*{password}" 
                               autocomplete="current-password"
                               th:class="${#fields.hasErrors('password')} ? 'error' : ''">
                        <i class="fas fa-eye password-toggle-icon" id="password-toggle"></i>
                    </div>
                    <div th:if="${#fields.hasErrors('password')}" class="error-msg">
                        <span th:errors="*{password}"></span>
                    </div>
                </div>
                
                <br>
                <input type="submit" value="ç™»å…¥" class="btn btn-primary">
            </form>

            <!-- å°èˆªé€£çµ -->
            <a th:href="@{/}" class="forgot-password-link">â† è¿”å›é¦–é </a>
            <a th:href="@{/employee/forgot-password}" class="forgot-password-link">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
        </div>
        
        <!-- ç®¡ç†å“¡å°å¹«æ‰‹å€å¡Š -->
        <div class="admin-helper" th:if="${employeeList != null and !employeeList.isEmpty()}">
            <h3>å“¡å·¥å¸³è™Ÿåˆ—è¡¨</h3>
            <ul class="info-list">
                <li th:each="emp : ${employeeList}" class="employee-item">
                    <div class="employee-main-info">
                        <span class="info-name" th:text="${emp.username}"></span>
                        <span class="info-account" th:text="${emp.account}"></span>
                    </div>
                    <div class="employee-details">
                        <p>
                            <span class="label">æ‰€å±¬åˆ†åº—:</span> 
                            <span th:text="${emp.storeName != null ? emp.storeName : 'é–€å¸‚ID ' + emp.storeId}"></span>
                        </p>
                        <p>
                            <span class="label">è§’è‰²è·ä½:</span> 
                            <span th:text="${emp.role.displayName}"></span>
                        </p>
                        <p>
                            <span class="label">å¸³è™Ÿç‹€æ…‹:</span> 
                            <span th:text="${emp.status}"></span>
                        </p>
                        <p>
                            <span class="label">å“¡å·¥å¯†ç¢¼:</span> 
                            <span style="color: #D9534F; font-family: monospace;"><i class="fas fa-lock"></i> ********</span>
                        </p>
                    </div>
                </li>
            </ul>
        </div>
        
        <!-- å·²åœæ¬Šå“¡å·¥å€å¡Š -->
        <div class="admin-helper inactive-employees" th:if="${inactiveEmployeeList != null and !inactiveEmployeeList.isEmpty()}">
            <h3>å·²åœæ¬Šå“¡å·¥åˆ—è¡¨</h3>
            <ul class="info-list">
                <li th:each="emp : ${inactiveEmployeeList}" class="employee-item inactive-item">
                    <div class="employee-main-info">
                        <span class="info-name" th:text="${emp.username}"></span>
                        <span class="info-account" th:text="${emp.account}"></span>
                    </div>
                    <div class="employee-details">
                        <p>
                            <span class="label">æ‰€å±¬åˆ†åº—:</span> 
                            <span th:text="${emp.storeName != null ? emp.storeName : 'é–€å¸‚ID ' + emp.storeId}"></span>
                        </p>
                        <p>
                            <span class="label">è§’è‰²è·ä½:</span> 
                            <span th:text="${emp.role.displayName}"></span>
                        </p>
                        <p>
                            <span class="label">å¸³è™Ÿç‹€æ…‹:</span> 
                            <span th:text="${emp.status}" style="color: #D9534F; font-weight: bold;"></span>
                        </p>
                        <p>
                            <span class="label">å“¡å·¥å¯†ç¢¼:</span> 
                            <span style="color: #D9534F; font-family: monospace;"><i class="fas fa-lock"></i> ********</span>
                        </p>
                        <p style="font-size: 12px; color: #999; margin-top: 10px;">
                            <i class="fas fa-exclamation-triangle"></i> 
                            æ­¤å¸³è™Ÿå·²åœæ¬Šï¼Œç„¡æ³•ç™»å…¥ç³»çµ±
                        </p>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // è¡¨å–®æäº¤æ™‚å°è¼¸å…¥å€¼é€²è¡Œ trim è™•ç†
        const loginForm = document.querySelector('form[method="post"]');
        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                // ç²å–å¸³è™Ÿå’Œå¯†ç¢¼è¼¸å…¥æ¡†
                const accountInput = document.getElementById('account');
                const passwordInput = document.getElementById('password');
                
                // å»é™¤å‰å¾Œç©ºç™½
                if (accountInput && accountInput.value) {
                    accountInput.value = accountInput.value.trim();
                }
                if (passwordInput && passwordInput.value) {
                    passwordInput.value = passwordInput.value.trim();
                }
            });
        }

        // æˆåŠŸè¨Šæ¯è‡ªå‹•æ¶ˆå¤±åŠŸèƒ½
        const successMessage = document.querySelector('.success-msg');
        if (successMessage) {
            // 3ç§’å¾Œæ·¡å‡ºä¸¦ç§»é™¤æˆåŠŸè¨Šæ¯
            setTimeout(function() {
                successMessage.style.transition = 'opacity 0.5s ease-out';
                successMessage.style.opacity = '0';
                
                // æ·¡å‡ºå®Œæˆå¾Œç§»é™¤å…ƒç´ 
                setTimeout(function() {
                    successMessage.remove();
                }, 500); // 0.5ç§’æ·¡å‡ºå‹•ç•«æ™‚é–“
            }, 3000); // 3ç§’å¾Œé–‹å§‹æ·¡å‡º
        }

        // ç®¡ç†å“¡å°å¹«æ‰‹äº’å‹•é‚è¼¯
        const employeeItems = document.querySelectorAll('.employee-item');
        employeeItems.forEach(item => {
            item.addEventListener('click', function () {
                const details = this.querySelector('.employee-details');
                const isVisible = details.style.display === 'block';
                
                // é—œé–‰æ‰€æœ‰å…¶ä»–å±•é–‹çš„è©³æƒ…
                employeeItems.forEach(otherItem => {
                    otherItem.querySelector('.employee-details').style.display = 'none';
                });
                
                // åˆ‡æ›ç•¶å‰é …ç›®çš„é¡¯ç¤ºç‹€æ…‹
                if (!isVisible) {
                    details.style.display = 'block';
                }
            });
        });

        // å¯†ç¢¼é¡¯ç¤º/éš±è—çš„äº’å‹•é‚è¼¯
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('password-toggle');

        if (passwordInput && toggleIcon) {
            toggleIcon.addEventListener('click', function () {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // åˆ‡æ›çœ¼ç›åœ–ç¤ºçš„æ¨£å¼ (fa-eye <--> fa-eye-slash)
                this.classList.toggle('fa-eye-slash');
            });
        }

        // è‡ªå‹•å¡«å…¥å¸³è™ŸåŠŸèƒ½ï¼ˆé»æ“Šå“¡å·¥é …ç›®æ™‚ï¼‰
        employeeItems.forEach(item => {
            const accountSpan = item.querySelector('.info-account');
            if (accountSpan) {
                accountSpan.addEventListener('click', function(e) {
                    e.stopPropagation(); // é˜²æ­¢è§¸ç™¼çˆ¶å…ƒç´ çš„é»æ“Šäº‹ä»¶
                    const account = this.textContent.trim();
                    const accountInput = document.getElementById('account');
                    if (accountInput) {
                        accountInput.value = account;
                        accountInput.focus();
                    }
                });
                
                // æ·»åŠ è¦–è¦ºæç¤º
                accountSpan.style.cursor = 'pointer';
                accountSpan.title = 'é»æ“Šå¡«å…¥å¸³è™Ÿ';
            }
        });
    });
    </script>
</body>
</html>